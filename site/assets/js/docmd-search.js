/*!
 * --------------------------------------------------------------------
 * docmd : the minimalist, zero-config documentation generator.
 *
 * @package     @docmd/core (and ecosystem)
 * @website     https://docmd.io
 * @repository  https://github.com/docmd-io/docmd
 * @license     MIT
 * @copyright   Copyright (c) 2025-present docmd.io
 *
 * [docmd-source] - Please do not remove this header.
 * --------------------------------------------------------------------
 */
(function(){let w=null,m=!1,n=-1;const c=document.getElementById("docmd-search-modal"),d=document.getElementById("docmd-search-input"),i=document.getElementById("docmd-search-results"),p=window.DOCMD_ROOT||"./",v=p.endsWith("/")?p:p+"/";if(!c)return;const x='<div class="search-initial">Type to start searching...</div>';function E(){c.style.display="flex",window.lastFocusedElement=document.activeElement,setTimeout(()=>d.focus(),50),d.value.trim()||(i.innerHTML=x,n=-1),m||L()}function f(){c.style.display="none",window.lastFocusedElement&&window.lastFocusedElement.focus(),n=-1}document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),c.style.display==="flex"?f():E()),c.style.display==="flex"){const t=i.querySelectorAll(".search-result-item");if(e.key==="Escape")e.preventDefault(),f();else if(e.key==="ArrowDown"){if(e.preventDefault(),t.length===0)return;n=(n+1)%t.length,g(t)}else if(e.key==="ArrowUp"){if(e.preventDefault(),t.length===0)return;n=(n-1+t.length)%t.length,g(t)}else e.key==="Enter"&&(e.preventDefault(),n>=0&&t[n]?t[n].click():t.length>0&&t[0].click())}});function g(e){e.forEach((t,s)=>{s===n?(t.classList.add("selected"),t.scrollIntoView({block:"nearest"})):t.classList.remove("selected")})}document.querySelectorAll(".docmd-search-trigger").forEach(e=>{e.addEventListener("click",E)}),c.addEventListener("click",e=>{e.target===c&&f()});async function L(){try{const e=`${v}search-index.json`;console.log("Fetching index from:",e);const t=await fetch(e),s=t.headers.get("content-type");if(s&&s.includes("text/html"))throw new Error("Server returned HTML instead of JSON. Check paths.");if(!t.ok)throw new Error(t.status);const r=await t.text();w=MiniSearch.loadJSON(r,{fields:["title","headings","text"],storeFields:["title","id","text"],searchOptions:{fuzzy:.2,prefix:!0,boost:{title:2,headings:1.5}}}),m=!0,d.value.trim()&&d.dispatchEvent(new Event("input"))}catch(e){console.error("Failed to load search index",e),i.innerHTML='<div class="search-error">Failed to load search index.</div>'}}function T(e,t){if(!e)return"";const s=t.split(/\s+/).filter(a=>a.length>2),r=e.toLowerCase();let l=-1;for(const a of s){const S=r.indexOf(a.toLowerCase());if(S>=0){l=S;break}}const u=60;let h=0,y=120;l>=0&&(h=Math.max(0,l-u),y=Math.min(e.length,l+u));let o=e.substring(h,y);h>0&&(o="..."+o),y<e.length&&(o=o+"...");const k=s.map(a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|");if(k){const a=new RegExp(`(${k})`,"gi");o=o.replace(a,"<mark>$1</mark>")}return o}d.addEventListener("input",e=>{const t=e.target.value.trim();if(n=-1,!t){i.innerHTML=x;return}if(!m)return;const s=w.search(t);M(s,t)});function M(e,t){if(e.length===0){i.innerHTML='<div class="search-no-results">No results found.</div>';return}const s=e.slice(0,10).map((r,l)=>{const u=T(r.text,t);return`
                <a href="${`${v}${r.id}`}" class="search-result-item" data-index="${l}" onclick="window.closeDocmdSearch()">
                    <div class="search-result-title">${r.title}</div>
                    <div class="search-result-preview">${u}</div>
                </a>
            `}).join("");i.innerHTML=s,i.querySelectorAll(".search-result-item").forEach((r,l)=>{r.addEventListener("mouseenter",()=>{n=l,g(i.querySelectorAll(".search-result-item"))})})}window.closeDocmdSearch=f})();
